# ç¯å¢ƒå˜é‡æ¨¡å—æ³¨å†Œæœºåˆ¶ - å¿«é€Ÿå‚è€ƒ

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### ä»€ä¹ˆæ˜¯ç¯å¢ƒå˜é‡æ¨¡å—ï¼Ÿ

**å®šä¹‰**: ä¸€ä¸ª Python æ¨¡å—ï¼ŒåŒ…å«ä»¥ `OTEL_` å¼€å¤´çš„å¸¸é‡å®šä¹‰

**ç¤ºä¾‹**:
```python
# opentelemetry/instrumentation/environment_variables.py
OTEL_PYTHON_DISABLED_INSTRUMENTATIONS = "OTEL_PYTHON_DISABLED_INSTRUMENTATIONS"
OTEL_PYTHON_DISTRO = "OTEL_PYTHON_DISTRO"
```

---

## ğŸ“ æ³¨å†Œæ­¥éª¤ï¼ˆ3æ­¥ï¼‰

### æ­¥éª¤ 1: åˆ›å»ºæ¨¡å—
```python
# src/my_package/environment_variables.py
OTEL_MY_SETTING = "OTEL_MY_SETTING"
```

### æ­¥éª¤ 2: æ³¨å†Œ Entry Point
```toml
# pyproject.toml
[project.entry-points.opentelemetry_environment_variables]
my_module = "my_package.environment_variables"
```

### æ­¥éª¤ 3: å®‰è£…åŒ…
```bash
pip install -e .
```

---

## ğŸ” å‘ç°å’Œä½¿ç”¨

### ä»£ç ç¤ºä¾‹
```python
from opentelemetry.util._importlib_metadata import entry_points

# å‘ç°æ‰€æœ‰ç¯å¢ƒå˜é‡æ¨¡å—
for entry_point in entry_points(group="opentelemetry_environment_variables"):
    module = entry_point.load()
    
    # æ‰«æ OTEL_ å¸¸é‡
    for attr in dir(module):
        if attr.startswith("OTEL_"):
            print(f"{attr} = {getattr(module, attr)}")
```

---

## ğŸ¨ å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¯å¢ƒå˜é‡æ¨¡å—æ³¨å†Œæµç¨‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ å¼€å‘é˜¶æ®µ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å¼€å‘è€…åˆ›å»ºç¯å¢ƒå˜é‡æ¨¡å—                                    â”‚
   â”‚                                                          â”‚
   â”‚ # environment_variables.py                              â”‚
   â”‚ OTEL_SERVICE_NAME = "OTEL_SERVICE_NAME"                 â”‚
   â”‚ OTEL_TRACES_EXPORTER = "OTEL_TRACES_EXPORTER"           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ åœ¨ pyproject.toml ä¸­æ³¨å†Œ Entry Point                     â”‚
   â”‚                                                          â”‚
   â”‚ [project.entry-points.opentelemetry_environment_variables]â”‚
   â”‚ sdk = "opentelemetry.sdk.environment_variables"         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2ï¸âƒ£ å®‰è£…é˜¶æ®µ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ pip install å®‰è£…åŒ…                                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Entry Point æ³¨å†Œåˆ° Python ç¯å¢ƒ                           â”‚
   â”‚ (å­˜å‚¨åœ¨ .dist-info/entry_points.txt)                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3ï¸âƒ£ è¿è¡Œé˜¶æ®µ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ç”¨æˆ·æ‰§è¡Œå‘½ä»¤                                             â”‚
   â”‚ $ opentelemetry-instrument python app.py                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ run() å‡½æ•°è°ƒç”¨ entry_points()                            â”‚
   â”‚ å‘ç°æ‰€æœ‰ç¯å¢ƒå˜é‡æ¨¡å—                                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ åŠ è½½æ¯ä¸ªæ¨¡å—                                             â”‚
   â”‚ module = entry_point.load()                             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æ‰«ææ¨¡å—ä¸­çš„ OTEL_ å¸¸é‡                                  â”‚
   â”‚ for attr in dir(module):                                â”‚
   â”‚     if attr.startswith("OTEL_"):                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ä¸ºæ¯ä¸ªå¸¸é‡åˆ›å»ºå‘½ä»¤è¡Œå‚æ•°                                 â”‚
   â”‚ OTEL_SERVICE_NAME â†’ --service_name                      â”‚
   â”‚ OTEL_TRACES_EXPORTER â†’ --traces_exporter               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ç”¨æˆ·å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°                                   â”‚
   â”‚ $ opentelemetry-instrument \                            â”‚
   â”‚     --service_name=my-app \                             â”‚
   â”‚     --traces_exporter=console \                         â”‚
   â”‚     python app.py                                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š å·²æ³¨å†Œçš„ç¯å¢ƒå˜é‡æ¨¡å—

### opentelemetry-instrumentation
```
Entry Point: instrumentation
æ¨¡å—è·¯å¾„: opentelemetry.instrumentation.environment_variables

ç¯å¢ƒå˜é‡:
  â€¢ OTEL_PYTHON_DISABLED_INSTRUMENTATIONS
  â€¢ OTEL_PYTHON_DISTRO
  â€¢ OTEL_PYTHON_CONFIGURATOR
  â€¢ OTEL_PYTHON_AUTO_INSTRUMENTATION_EXPERIMENTAL_GEVENT_PATCH
```

### opentelemetry-sdk
```
Entry Point: sdk
æ¨¡å—è·¯å¾„: opentelemetry.sdk.environment_variables

ç¯å¢ƒå˜é‡:
  â€¢ OTEL_SERVICE_NAME
  â€¢ OTEL_RESOURCE_ATTRIBUTES
  â€¢ OTEL_TRACES_EXPORTER
  â€¢ OTEL_TRACES_SAMPLER
  â€¢ OTEL_METRICS_EXPORTER
  â€¢ OTEL_LOGS_EXPORTER
  â€¢ OTEL_EXPORTER_OTLP_ENDPOINT
  â€¢ OTEL_EXPORTER_OTLP_HEADERS
  â€¢ OTEL_EXPORTER_OTLP_PROTOCOL
  â€¢ OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT
  â€¢ OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT
  â€¢ ... æ›´å¤š
```

---

## ğŸ”„ è½¬æ¢è§„åˆ™

### ç¯å¢ƒå˜é‡ â†’ å‘½ä»¤è¡Œå‚æ•°

| ç¯å¢ƒå˜é‡ | å‘½ä»¤è¡Œå‚æ•° | è½¬æ¢è§„åˆ™ |
|---------|-----------|---------|
| `OTEL_SERVICE_NAME` | `--service_name` | ç§»é™¤ `OTEL_`ï¼Œè½¬å°å†™ |
| `OTEL_TRACES_EXPORTER` | `--traces_exporter` | ç§»é™¤ `OTEL_`ï¼Œè½¬å°å†™ |
| `OTEL_PYTHON_DISTRO` | `--distro` | ç§»é™¤ `OTEL_PYTHON_`ï¼Œè½¬å°å†™ |
| `OTEL_PYTHON_DISABLED_INSTRUMENTATIONS` | `--disabled_instrumentations` | ç§»é™¤ `OTEL_PYTHON_`ï¼Œè½¬å°å†™ |

### è½¬æ¢ä»£ç 
```python
from re import sub

env_var = "OTEL_SERVICE_NAME"
argument = sub(r"OTEL_(PYTHON_)?", "", env_var).lower()
# ç»“æœ: "service_name"
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: åŸºæœ¬ä½¿ç”¨
```bash
opentelemetry-instrument \
  --service_name=my-app \
  --traces_exporter=console \
  python app.py
```

**ç­‰ä»·äºè®¾ç½®ç¯å¢ƒå˜é‡**:
```bash
export OTEL_SERVICE_NAME=my-app
export OTEL_TRACES_EXPORTER=console
python app.py
```

### ç¤ºä¾‹ 2: å®Œæ•´é…ç½®
```bash
opentelemetry-instrument \
  --service_name=my-flask-app \
  --traces_exporter=otlp \
  --metrics_exporter=prometheus \
  --exporter_otlp_endpoint=http://localhost:4317 \
  --disabled_instrumentations=flask,requests \
  python app.py --port 8080
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆ opentelemetry.sdk.environment_variables æ˜¯ç¯å¢ƒå˜é‡æ¨¡å—ï¼Ÿ

**ç­”**: å› ä¸ºå®ƒæ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š
1. âœ… å®šä¹‰äº† `OTEL_` å¼€å¤´çš„å¸¸é‡
2. âœ… é€šè¿‡ Entry Points æ³¨å†Œ
3. âœ… è¢« `opentelemetry-instrument` è‡ªåŠ¨å‘ç°

### Q2: å¦‚ä½•æŸ¥çœ‹æ‰€æœ‰å·²æ³¨å†Œçš„ç¯å¢ƒå˜é‡æ¨¡å—ï¼Ÿ

**ç­”**: è¿è¡Œæ¼”ç¤ºè„šæœ¬ï¼š
```bash
python demo_environment_variables.py
```

### Q3: å¦‚ä½•åˆ›å»ºè‡ªå·±çš„ç¯å¢ƒå˜é‡æ¨¡å—ï¼Ÿ

**ç­”**: ä¸‰æ­¥èµ°ï¼š
1. åˆ›å»ºæ¨¡å—ï¼Œå®šä¹‰ `OTEL_` å¸¸é‡
2. åœ¨ `pyproject.toml` ä¸­æ³¨å†Œ Entry Point
3. `pip install -e .` å®‰è£…åŒ…

### Q4: Entry Point å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ

**ç­”**: å®‰è£…åŒ…åï¼ŒEntry Point ä¿¡æ¯å­˜å‚¨åœ¨ï¼š
```
site-packages/<package>-<version>.dist-info/entry_points.txt
```

### Q5: å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡çš„ä¼˜å…ˆçº§ï¼Ÿ

**ç­”**: å‘½ä»¤è¡Œå‚æ•°ä¼˜å…ˆçº§æ›´é«˜ï¼Œä¼šè¦†ç›–å·²å­˜åœ¨çš„ç¯å¢ƒå˜é‡ã€‚

---

## ğŸ“ æ ¸å¿ƒä»£ç ç‰‡æ®µ

### run() å‡½æ•°ä¸­çš„å…³é”®ä»£ç 
```python
# 1. å‘ç°æ‰€æœ‰ç¯å¢ƒå˜é‡æ¨¡å—
for entry_point in entry_points(group="opentelemetry_environment_variables"):
    # 2. åŠ è½½æ¨¡å—
    environment_variable_module = entry_point.load()
    
    # 3. æ‰«æ OTEL_ å¸¸é‡
    for attribute in dir(environment_variable_module):
        if attribute.startswith("OTEL_"):
            # 4. è½¬æ¢ä¸ºå‘½ä»¤è¡Œå‚æ•°å
            argument = sub(r"OTEL_(PYTHON_)?", "", attribute).lower()
            
            # 5. æ·»åŠ å‘½ä»¤è¡Œå‚æ•°
            parser.add_argument(f"--{argument}", required=False)
            
            # 6. å»ºç«‹æ˜ å°„å…³ç³»
            argument_otel_environment_variable[argument] = attribute

# 7. è§£æå‘½ä»¤è¡Œå‚æ•°
args = parser.parse_args()

# 8. è®¾ç½®ç¯å¢ƒå˜é‡
for argument, otel_environment_variable in argument_otel_environment_variable.items():
    value = getattr(args, argument)
    if value is not None:
        environ[otel_environment_variable] = value
```

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- **è¯¦ç»†æ–‡æ¡£**: `ç¯å¢ƒå˜é‡æ¨¡å—æ³¨å†Œæœºåˆ¶è¯¦è§£.md`
- **æ¼”ç¤ºè„šæœ¬**: `demo_environment_variables.py`
- **æºç **: `opentelemetry-instrumentation/src/opentelemetry/instrumentation/auto_instrumentation/__init__.py`

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æŸ¥çœ‹å·²æ³¨å†Œçš„æ¨¡å—
```bash
python demo_environment_variables.py
```

### 2. é˜…è¯»è¯¦ç»†æ–‡æ¡£
```bash
cat ç¯å¢ƒå˜é‡æ¨¡å—æ³¨å†Œæœºåˆ¶è¯¦è§£.md
```

### 3. æŸ¥çœ‹æºç æ³¨é‡Š
```bash
cat opentelemetry-instrumentation/src/opentelemetry/instrumentation/auto_instrumentation/__init__.py
```

---

**æç¤º**: è¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿå‚è€ƒæ–‡æ¡£ï¼Œè¯¦ç»†å†…å®¹è¯·æŸ¥çœ‹ `ç¯å¢ƒå˜é‡æ¨¡å—æ³¨å†Œæœºåˆ¶è¯¦è§£.md`
